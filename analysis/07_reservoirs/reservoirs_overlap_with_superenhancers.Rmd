---
title: "Reservoir overlaps with annotated superenhancers"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
options(stringsAsFactors = FALSE)
knitr::opts_chunk$set(echo = TRUE)
library(rtracklayer)
library(liftOver)
library(tidyverse)
```

# Retrieving superenhancer info

We got this from the SEdb: https://asntech.org/dbsuper/

`wget http://asntech.org/dbsuper/data/bed/hg19/K562.bed`

```{r}
reservoirs <- rtracklayer::import("../04_correlation_with_expression/results/k562_ghost_promoters.bed")
se_hg19 <- rtracklayer::import("K562.bed")
ch <- import.chain("hg19ToHg38.over.chain")
```

`http://hgdownload.cse.ucsc.edu/goldenpath/hg19/liftOver/hg19ToHg38.over.chain.gz`  
`gunzip hg19ToHg38.over.chain.gz`

```{r}
seqlevelsStyle(se_hg19) <- "UCSC"  # necessary
se_hg38 <- liftOver(se_hg19, ch)
# Subset just to contiguously liftedOver regions
se_hg38 <- se_hg38[sapply(width(se_hg38), length) == 1]
rtracklayer::export(se_hg38, "results/k562_superenhancers_hg38.bed")
```

```{r}
se_hg38 <- rtracklayer::import("results/k562_superenhancers_hg38.bed")
```

### Look at the overlaps between reservoirs and superenhancers

```{r}
library(GenomicRanges)
se_res_ov <- findOverlaps(reservoirs, se_hg38)
reservoirs_overlapping_ses <- reservoirs[se_res_ov@from]
rtracklayer::export(reservoirs_overlapping_ses, "results/reservoirs_overlapping_ses.bed")
```


